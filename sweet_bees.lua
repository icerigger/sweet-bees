-- Sweet Bees
-- v1.0.0 @midworld
-- llllllll.co/t/sweet-bees
-- 
-- Two-Track Asynchronous
-- Tape Looper and Reverb
--
--
-- E1: Honeycomb Reverb
-- E2: T1 Volume
-- E3: T2 Volume
-- K2: T1 Record/Loop
-- K3: T2 Record/Loop
-- K1+K2: T1 Slow/Stop/Play
-- K1+K3: T2 Slow/Stop/Play

-- K2 (hold): T1 Easter Egg
-- K3 (hold): T2 Easter Egg

function init()
  
  -- Audio
  
  audio.level_adc_cut(1)                                            -- sends audio input to softcut
  audio:rev_off()                                                   -- turns off system reverb
  
  -- Animation Loop
  
  animation = metro.init()                                          -- creates the animation loop
  animation.time = 1/15                                             -- sets the animation rate to 15 frames per second
  animation.event = function() redraw() end                         -- updates the screen at the animation rate
  animation:start()                                                 -- starts the animation loop
  
  -- Softcut
  
  softcut.buffer_clear()                                            -- clears the buffers
  softcut.event_phase(update_tape)                                  -- sets function for softcut phase poll
  softcut.poll_start_phase()                                        -- starts the softcut phase poll
  
  for i = 1, 2 do
    softcut.enable(i,1)                                             -- enables voices 1 and 2
    softcut.buffer(i,i)                                             -- sets voice 1 to buffer 1, voice 2 to buffer 2
    softcut.level(i,0)                                              -- sets output level of voices 1 and 2
    softcut.loop(i,1)                                               -- sets voices 1 and 2 to loop mode
    softcut.loop_start(i,0)                                         -- sets loop start for voices 1 and 2 (beginning of tape)
    softcut.loop_end(i,33)                                          -- sets loop end for voices 1 and 2 (33 seconds)
    softcut.position(i,0)                                           -- sets playing positions for voices 1 and 2 (beginning of tape)
    softcut.pre_level(i,0)                                          -- sets voices 1 and 2 to overwrite / disable overdub
    softcut.rec_level(i,1)                                          -- sets record levels of voices 1 and 2
    softcut.rate(i,1.0)                                             -- sets rate of voices 1 and 2 to x1
    softcut.phase_quant(i,.25)                                      -- sets poll updates to four times per second for voices 1 and 2
    softcut.level_input_cut(1,i,1)                                  -- sets softcut input to mono
  end
  
  -- Honeycomb Reverb
  
  honeycomb = {   {02,20,50,.1,01,1500},                            -- the honeycomb reverb is a series of presets for the system reverb.
                  {02,20,50,.1,02,1500},                            -- specifically, the return level and mid time are affected
                  {04,20,50,.1,03,1500},                            -- to provoke longer tails and mask the "gap" often associated
                  {04,20,50,.1,04,1500},                            -- with handmade tape loops.
                  {04,20,50,.1,05,1500},
                  {04,20,50,.1,06,1500},
                  {06,20,50,.1,07,1500},
                  {06,20,50,.1,08,1500},
                  {06,20,50,.1,09,1500},
                  {06,20,50,.1,10,1500},
                  {08,20,50,.1,11,1500},
                  {08,20,50,.1,12,1500},
                  {08,20,50,.1,13,1500},
                  {08,20,50,.1,14,1500} }
  
  -- Sprites
  
  beesprite = {   {00,00,00,00,00,00,00,00,00,00,00,00,01,00,00,00,00,00,00,00,00,01,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,01,00,00,00,00,00,00,01,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,01,00,00,00,00,01,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,01,00,00,00,00,00,00,01,01,01,01,00,00,00,00,00,00,01,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,01,00,00,00,00,01,01,00,00,01,01,00,00,00,00,01,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,01,00,00,01,00,01,00,00,01,00,01,00,00,01,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,01,00,01,01,01,00,00,01,01,01,00,01,00,00,00,00,00,00,00,00,00,00,00},
                  {00,01,01,01,01,01,00,00,00,00,00,01,00,01,01,01,00,00,01,01,01,00,01,00,00,00,00,00,01,01,01,01,01,00},
                  {01,00,00,00,00,00,01,01,01,01,00,01,00,00,01,00,00,00,00,01,00,00,01,00,01,01,01,01,00,00,00,00,00,01},
                  {00,01,00,00,00,00,00,00,00,00,01,01,01,01,01,00,00,00,00,01,01,01,01,01,00,00,00,00,00,00,00,00,01,00},
                  {00,00,01,00,00,00,00,00,00,00,00,00,00,01,00,00,00,00,00,00,01,00,00,00,00,00,00,00,00,00,00,01,00,00},
                  {00,00,00,01,01,01,01,01,01,01,01,01,01,01,00,00,00,00,00,00,01,01,01,01,01,01,01,01,01,01,01,00,00,00},
                  {00,00,00,00,00,00,01,00,00,00,00,00,00,01,00,00,00,00,00,00,01,00,00,00,00,00,00,01,00,00,00,00,00,00},
                  {00,00,00,00,00,00,01,00,00,00,00,00,00,00,01,00,00,00,00,01,00,00,00,00,00,00,00,01,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,01,00,00,00,00,01,01,01,01,01,01,01,01,01,01,00,00,00,00,01,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,01,01,01,01,00,01,00,00,00,00,00,00,01,00,01,01,01,01,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,01,01,01,01,01,01,01,01,01,01,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,01,01,00,00,00,00,00,00,00,00,01,01,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,01,00,01,00,00,00,00,00,00,00,00,01,00,01,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,01,00,00,01,01,01,01,01,01,01,01,01,01,00,00,01,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,01,00,01,00,01,00,00,00,00,00,00,01,00,01,00,01,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,01,00,01,00,00,01,01,01,01,01,01,00,00,01,00,01,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,01,00,00,01,00,00,00,01,01,01,01,00,00,00,01,00,00,01,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,01,00,00,01,00,00,00,00,00,01,01,00,00,00,00,00,01,00,00,01,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,01,00,00,00,00,00,00,00,00,00,00,00,00,01,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00} }
                  
  hivesprite = {  {00,00,00,00,00,00,00,00,00,00,01,01,00,00,00,00,00,00,00,00,00,00,01,01,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,01,00,00,01,00,00,00,00,00,00,00,00,01,00,00,01,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,01,00,00,00,00,01,00,00,00,00,00,00,01,00,00,00,00,01,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,01,00,00,00,00,00,00,01,00,00,00,00,01,00,00,00,00,00,00,01,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,01,00,00,00,00,00,00,00,00,01,00,00,01,00,00,00,00,00,00,00,00,01,00,00,00,00,00,00},
                  {00,00,00,00,00,00,01,00,00,00,00,00,00,00,00,01,00,00,01,00,00,00,00,00,00,00,00,01,00,00,00,00,00,00},
                  {00,00,00,00,00,00,01,00,00,00,00,00,00,00,00,01,00,00,01,00,00,00,00,00,00,00,00,01,00,00,00,00,00,00},
                  {00,00,00,00,00,00,01,00,00,00,00,00,00,00,00,01,00,00,01,00,00,00,00,00,00,00,00,01,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,01,00,00,00,00,00,00,01,00,00,00,00,01,00,00,00,00,00,00,01,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,01,00,00,00,00,01,00,00,00,00,00,00,01,00,00,00,00,01,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,01,00,00,01,00,00,00,00,00,00,00,00,01,00,00,01,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,01,01,00,00,00,00,01,01,00,00,00,00,01,01,00,00,00,00,01,01,00,00,00,00,01,01,00,00,00,00},
                  {00,00,00,01,00,00,01,00,00,00,00,00,00,00,00,01,00,00,01,00,00,00,00,00,00,00,00,01,00,00,01,00,00,00},
                  {00,00,01,00,00,00,00,01,00,00,00,00,00,00,01,00,00,00,00,01,00,00,00,00,00,00,01,00,00,00,00,01,00,00},
                  {00,01,00,00,00,00,00,00,01,00,00,00,00,01,00,00,00,00,00,00,01,00,00,00,00,01,00,00,00,00,00,00,01,00},
                  {01,00,00,00,00,00,00,00,00,01,00,00,01,00,00,00,00,00,00,00,00,01,00,00,01,00,00,00,00,00,00,00,00,01},
                  {01,00,00,00,00,00,00,00,00,01,00,00,01,00,00,00,00,00,00,00,00,01,00,00,01,00,00,00,00,00,00,00,00,01},
                  {01,00,00,00,00,00,00,00,00,01,00,00,01,00,00,00,00,00,00,00,00,01,00,00,01,00,00,00,00,00,00,00,00,01},
                  {01,00,00,00,00,00,00,00,00,01,00,00,01,00,00,00,00,00,00,00,00,01,00,00,01,00,00,00,00,00,00,00,00,01},
                  {00,01,00,00,00,00,00,00,01,00,00,00,00,01,00,00,00,00,00,00,01,00,00,00,00,01,00,00,00,00,00,00,01,00},
                  {00,00,01,00,00,00,00,01,00,00,00,00,00,00,01,00,00,00,00,01,00,00,00,00,00,00,01,00,00,00,00,01,00,00},
                  {00,00,00,01,00,00,01,00,00,00,00,00,00,00,00,01,00,00,01,00,00,00,00,00,00,00,00,01,00,00,01,00,00,00},
                  {00,00,00,00,01,01,00,00,00,00,01,01,00,00,00,00,01,01,00,00,00,00,01,01,00,00,00,00,01,01,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,01,00,00,01,00,00,00,00,00,00,00,00,01,00,00,01,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,01,00,00,00,00,01,00,00,00,00,00,00,01,00,00,00,00,01,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,01,00,00,00,00,00,00,01,00,00,00,00,01,00,00,00,00,00,00,01,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,01,00,00,00,00,00,00,00,00,01,00,00,01,00,00,00,00,00,00,00,00,01,00,00,00,00,00,00},
                  {00,00,00,00,00,00,01,00,00,00,00,00,00,00,00,01,00,00,01,00,00,00,00,00,00,00,00,01,00,00,00,00,00,00},
                  {00,00,00,00,00,00,01,00,00,00,00,00,00,00,00,01,00,00,01,00,00,00,00,00,00,00,00,01,00,00,00,00,00,00},
                  {00,00,00,00,00,00,01,00,00,00,00,00,00,00,00,01,00,00,01,00,00,00,00,00,00,00,00,01,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,01,00,00,00,00,00,00,01,00,00,00,00,01,00,00,00,00,00,00,01,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,01,00,00,00,00,01,00,00,00,00,00,00,01,00,00,00,00,01,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,01,00,00,01,00,00,00,00,00,00,00,00,01,00,00,01,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,01,01,00,00,00,00,00,00,00,00,00,00,01,01,00,00,00,00,00,00,00,00,00,00} }

  egg1sprite1 = { {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,01,01,01,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,01,01,01,08,08,01,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,01,04,04,04,01,08,08,01,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,01,04,04,04,04,04,01,01,01,01,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,01,04,04,04,04,04,01,08,08,04,01,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,01,08,04,04,04,04,04,04,01,01,04,01,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,01,08,04,04,12,15,15,15,04,04,15,01,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,01,08,04,12,15,15,01,01,12,01,15,01,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,01,04,12,15,15,01,01,12,01,15,01,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,01,01,04,12,12,15,15,15,12,15,12,01,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,01,01,08,08,01,04,12,01,01,01,01,12,01,01,01,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,01,04,08,08,08,08,01,12,12,12,12,12,01,08,08,04,01,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,01,04,04,08,08,08,08,01,01,01,01,01,08,08,04,04,01,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,01,04,04,04,08,01,08,08,08,08,08,08,08,01,08,04,04,04,01,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,01,04,04,01,01,01,08,08,08,08,08,08,08,01,01,01,04,04,01,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,01,04,04,04,01,01,08,08,08,08,08,08,08,01,01,04,04,04,01,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,01,04,04,04,01,01,04,04,04,04,04,04,04,01,01,04,04,04,01,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,01,01,01,00,01,04,04,04,04,04,04,04,01,00,01,01,01,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,01,08,08,04,04,04,04,04,08,08,01,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,01,08,08,08,08,04,04,04,08,08,08,08,01,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,01,01,04,08,08,08,08,01,08,08,08,04,04,01,01,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,01,01,04,04,04,04,04,08,01,00,01,08,04,04,04,04,04,01,01,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,01,04,04,04,04,04,04,04,01,00,00,00,01,04,04,04,04,04,04,04,01,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,01,01,01,01,01,01,01,01,01,00,00,00,01,01,01,01,01,01,01,01,01,01,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00} }
  
  egg1sprite2 = { {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,01,01,01,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,01,01,01,08,08,01,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,01,04,04,04,01,08,08,01,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,01,04,04,04,04,04,01,01,01,01,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,01,04,04,04,04,04,01,08,08,04,01,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,01,08,04,04,04,04,04,04,01,01,04,01,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,01,01,01,08,04,04,12,15,15,15,04,04,15,01,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,01,01,08,08,01,08,04,12,15,15,01,01,12,01,15,01,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,01,08,08,08,08,08,01,04,12,15,15,01,01,12,01,15,01,00,00,00,01,01,01,01,00,00,00,00},
                  {00,00,00,00,00,01,04,08,08,08,08,08,01,04,12,12,15,15,15,12,15,12,01,01,01,01,04,04,04,01,01,01,00,00},
                  {00,00,00,00,00,01,04,04,04,08,01,08,08,01,04,12,01,01,01,01,12,01,01,08,08,01,04,08,08,08,01,08,01,00},
                  {00,00,00,00,00,01,04,04,04,01,04,01,08,08,01,12,12,12,12,12,01,08,08,08,08,01,04,04,04,04,01,04,01,00},
                  {00,00,00,00,00,00,01,04,04,01,04,04,01,08,08,01,01,01,01,01,08,08,08,08,08,01,04,04,04,01,01,01,00,00},
                  {00,00,00,00,00,00,00,01,04,04,04,04,01,08,08,08,08,08,08,08,01,01,01,01,01,00,01,01,01,01,00,00,00,00},
                  {00,00,00,00,00,00,00,00,01,04,04,01,08,08,08,08,08,08,08,01,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,01,01,04,04,08,08,08,08,08,01,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,01,04,04,04,04,04,04,04,01,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,01,08,04,04,04,04,04,04,08,01,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,01,08,08,08,04,04,04,04,08,08,08,01,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,01,04,08,08,08,08,01,01,08,08,08,04,04,01,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,01,01,04,04,04,08,08,01,00,00,01,04,04,04,04,01,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,01,01,04,04,04,04,04,04,01,00,00,00,01,04,04,04,01,01,01,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,01,04,04,04,04,04,04,04,01,00,00,00,01,04,04,04,04,04,04,04,01,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,01,01,01,01,01,01,01,01,01,00,00,00,01,01,01,01,01,01,01,01,01,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00} }

  egg2sprite1 = { {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,01,01,00,01,01,01,01,00,00,00,01,01,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,01,15,15,01,04,04,04,04,01,00,01,08,01,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,01,15,15,15,15,01,04,04,04,04,01,01,08,01,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,01,15,01,15,15,01,04,04,04,04,04,01,08,01,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,01,15,15,15,15,01,04,01,01,04,04,08,01,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,01,15,15,01,04,01,15,15,04,08,08,01,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,01,01,01,01,04,01,01,15,15,04,08,08,01,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,01,08,01,12,15,01,01,15,12,04,04,08,01,01,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,01,04,04,12,15,15,12,04,04,01,01,01,01,01,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,01,04,04,04,04,04,04,04,01,01,01,01,08,08,01,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,01,01,04,04,04,04,04,04,01,01,01,01,08,08,08,08,01,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,01,08,08,01,04,04,04,01,01,01,04,01,01,01,08,08,08,01,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,01,04,08,01,01,01,01,01,01,01,04,04,01,01,01,01,01,04,04,01,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,01,04,04,01,04,01,01,01,01,04,04,04,04,01,01,01,04,04,04,01,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,01,04,04,01,04,08,08,01,04,04,04,04,04,01,01,04,04,04,04,01,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,01,04,01,01,08,08,01,04,04,04,04,01,01,01,04,04,04,01,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,01,01,01,01,04,04,04,04,01,01,01,01,01,04,04,01,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,01,01,01,01,01,01,01,01,01,01,01,01,01,01,01,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,01,04,01,01,01,01,01,00,00,01,01,01,01,04,01,01,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,01,04,04,01,01,01,00,00,00,00,01,01,01,04,04,08,01,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,01,01,08,08,04,01,00,00,00,00,00,00,01,04,04,08,08,08,01,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,01,08,08,08,08,08,01,00,00,00,00,00,00,00,01,08,08,08,08,08,01,01,00,00,00,00,00,00},
                  {00,00,00,00,00,01,08,08,08,08,08,08,08,01,00,00,00,00,00,00,01,08,08,08,08,08,08,08,01,00,00,00,00,00},
                  {00,00,00,00,00,01,01,01,01,01,01,01,01,01,00,00,00,00,00,00,01,01,01,01,01,01,01,01,01,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00} }

  egg2sprite2 = { {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,01,00,00,00,00,00,01,01,00,01,01,01,01,00,00,00,01,01,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,01,04,01,00,00,00,01,15,15,01,04,04,04,04,01,00,01,08,01,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,01,04,01,01,00,01,15,15,15,15,01,04,04,04,04,01,01,08,01,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,01,04,04,04,01,01,15,01,15,15,01,04,04,04,04,04,01,08,01,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,01,04,04,04,04,01,15,15,15,15,01,04,01,01,04,04,08,01,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,01,04,04,04,04,04,01,01,15,15,01,04,01,15,15,04,08,08,01,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,01,01,04,04,04,01,01,01,01,04,01,01,15,15,04,08,08,01,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,01,04,08,01,08,01,15,15,01,01,15,15,04,04,08,01,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,01,08,08,01,04,04,15,15,15,15,04,04,01,01,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,01,01,01,04,04,04,04,04,04,04,01,01,01,01,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,01,01,04,04,04,04,04,04,01,01,04,01,01,01,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,01,04,01,04,04,04,01,01,01,04,01,01,01,01,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,01,04,01,01,01,01,01,01,04,01,08,08,01,01,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,01,04,04,08,08,01,01,04,04,01,08,08,01,01,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,01,04,08,08,04,04,04,01,08,08,08,01,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,01,04,04,04,04,04,01,01,04,04,08,01,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,01,01,01,04,04,01,01,01,04,04,04,01,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,01,01,01,01,01,01,01,04,04,04,04,04,01,01,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,01,04,04,01,01,01,01,04,04,04,04,04,01,01,04,01,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,01,08,04,04,01,01,01,04,04,04,04,01,01,08,08,01,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,01,01,08,08,08,08,01,00,00,01,04,04,01,01,08,08,08,01,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,01,08,08,08,08,08,01,00,00,00,00,01,01,01,01,08,08,08,08,01,01,00,00,00,00,00,00,00},
                  {00,00,00,00,00,01,08,08,08,08,08,08,08,01,00,00,00,00,00,01,08,08,08,08,08,08,08,01,00,00,00,00,00,00},
                  {00,00,00,00,00,01,01,01,01,01,01,01,01,01,00,00,00,00,00,01,01,01,01,01,01,01,01,01,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00},
                  {00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00} }

  -- Variables
              
  preset = 0                                                        -- honeycomb reverb preset
  shift = 0                                                         -- shift flag
  tapeloops = {   {00,00,00,00,00,00,00},                           -- 1. pilot flag, 2. position, 3. record flag, 4. length,
                  {00,00,00,00,00,00,00} }                          -- 5. speed, 6. volume, 7. egg flag
                
end

function update_tape(voice,position)                                
  
  if voice == 1 then                                                
    tapeloops[1][2] = position
  else
    tapeloops[2][2] = position
  end
  
end

function enc(n,d)
  
  if n == 1 then                                                    
    preset = preset + d
    if preset < 1 then
      preset = 0
    elseif preset > 14 then
      preset = 14
    end
    if preset > 0 then                                                
      audio:rev_on ()
      params:set('rev_return_level', honeycomb[preset][1])
      params:set('rev_pre_delay', honeycomb[preset][2])
      params:set('rev_lf_fc', honeycomb[preset][3])
      params:set('rev_low_time', honeycomb[preset][4])
      params:set('rev_mid_time', honeycomb[preset][5])
      params:set('rev_hf_damping', honeycomb[preset][6])
    else
      audio:rev_off ()
    end
    redraw()
  elseif n == 2 then                                                
    tapeloops[1][6] = tapeloops[1][6] + d
    if tapeloops[1][6] < 1 then
      tapeloops[1][6] = 0
    elseif tapeloops[1][6] > 14 then
      tapeloops[1][6] = 14
    end
    softcut.level(1, tapeloops[1][6] / 14)
    redraw()
  elseif n == 3 then                                                
    tapeloops[2][6] = tapeloops[2][6] + d
    if tapeloops[2][6] < 1 then
      tapeloops[2][6] = 0
    elseif tapeloops[2][6] > 14 then
      tapeloops[2][6] = 14
    end
    softcut.level(2, tapeloops[2][6] / 14)
    redraw()
  end
  
end

function key(n,z)
  
  if n == 1 then                                                    
    shift = z
  end
  
  if n == 2 then                                                    
    if z == 1 then
      down_time = util.time()
    else
      hold_time = util.time() - down_time
      if hold_time > 1 and shift == 0 then
        if tapeloops[1][7] == 0 then
          tapeloops[1][7] = 1
        else
          tapeloops[1][7] = 0
        end
      else
        if shift == 1 then
          if tapeloops[1][3] == 0 and tapeloops[1][5] == 0 then
            softcut.rate(1,.5)
            tapeloops[1][5] = 1
          elseif tapeloops[1][3] == 0 and tapeloops[1][5] == 1 then
            softcut.rate(1,0)
            tapeloops[1][5] = 2
          else
            softcut.rate(1,1)
            tapeloops[1][5] = 0
          end
        else  
          if tapeloops[1][3] == 0 then
            tapeloops[1][2] = 0
            softcut.position(1, tapeloops[1][2])
            softcut.play(1,0)
            softcut.rec(1,1)
            softcut.loop_end(1,33)
            tapeloops[1][5] = 0
            softcut.rate(1,1)
            tapeloops[1][4] = 0
            tapeloops[1][3] = 1
            tapeloops[1][1] = 1
          else
            softcut.rec(1,0)
            softcut.loop_end(1,tapeloops[1][2])
            tapeloops[1][4] = 33 - tapeloops[1][2]
            tapeloops[1][2] = 0
            softcut.play(1,1)
            tapeloops[1][3] = 0
          end
        end
      end
    end
  end
  
  if n == 3 then 
    if z == 1 then
      down_time = util.time()
    else
      hold_time = util.time() - down_time
      if hold_time > 1 and shift == 0 then
        if tapeloops[2][7] == 0 then
          tapeloops[2][7] = 1
        else
          tapeloops[2][7] = 0
        end
      else
        if shift == 1 then
          if tapeloops[2][3] == 0 and tapeloops[2][5] == 0 then
            softcut.rate(2,.5)
            tapeloops[2][5] = 1
          elseif tapeloops[2][3] == 0 and tapeloops[2][5] == 1 then
            softcut.rate(2,0)
            tapeloops[2][5] = 2
          else
            softcut.rate(2,1)
            tapeloops[2][5] = 0
          end
        else
          if tapeloops[2][3] == 0 then
            tapeloops[2][2] = 0
            softcut.position(2, tapeloops[2][2])
            softcut.play(2,0)
            softcut.rec(2,1)
            softcut.loop_end(2,33)
            tapeloops[2][5] = 0
            softcut.rate(2,1)
            tapeloops[2][4] = 0
            tapeloops[2][3] = 1
            tapeloops[2][1] = 1
          else
            softcut.rec(2,0)
            softcut.loop_end(2,tapeloops[2][2])
            tapeloops[2][4] = 33 - tapeloops[2][2]
            tapeloops[2][2] = 0
            softcut.play(2,1)
            tapeloops[2][3] = 0
          end
        end
      end
    end
  end
  
end
  
function redraw()
  
  screen.clear()
  
  for x = 1, 34 do
    for y = 1, 34 do
      if hivesprite[y][x] == 1 then
        screen.level(hivesprite[y][x]+preset)
        screen.pixel(x+4,y+15)
        screen.fill()
      end
      if tapeloops[1][7] == 0 then
        if beesprite[y][x] > 0 then
          screen.level(1+tapeloops[1][6])
          screen.pixel(x+47,y+15)
          screen.fill()
        end
      else
        if tapeloops[1][3] == 1 or tapeloops[1][1] == 0 then
          if egg1sprite1[y][x] > 0 then
            screen.level(egg1sprite1[y][x])
            screen.pixel(x+47,y+15)
            screen.fill()
          end
        else
          if egg1sprite2[y][x] > 0 then
            screen.level(egg1sprite2[y][x])
            screen.pixel(x+47,y+15)
            screen.fill()
          end
        end
      end
      if tapeloops[2][7] == 0 then
        if beesprite[y][x] > 0 then
          screen.level(1+tapeloops[2][6])
          screen.pixel(x+91,y+15)
          screen.fill()
        end
      else
        if tapeloops[2][3] == 1 or tapeloops[2][1] == 0 then
          if egg2sprite1[y][x] > 0 then
            screen.level(egg2sprite1[y][x])
            screen.pixel(x+91,y+15)
            screen.fill()
          end
        else
          if egg2sprite2[y][x] > 0 then
            screen.level(egg2sprite2[y][x])
            screen.pixel(x+91,y+15)
            screen.fill()
          end
        end
      end
    end
  end
  
  screen.level(tapeloops[1][6]+1)
  screen.line_width(1)
  screen.rect(49,45,33-tapeloops[1][4],5)
  screen.stroke()
  screen.level(tapeloops[2][6]+1)
  screen.rect(93,45,33-tapeloops[2][4],5)
  screen.stroke()
  
  if tapeloops[1][3] == 1 then
    for x = 1, tapeloops[1][2] do
      screen.level(4)
      screen.line_width(4)
      screen.move(49,47)
      screen.line(49+x,47)
      screen.stroke()
    end
    if tapeloops[1][2] >= 32 then
      tapeloops[1][3] = 0
      tapeloops[1][4] = 0
      softcut.rec(1,0)
      softcut.play(1,1)
    end
  else
    for x = 1, tapeloops[1][2] do
      if tapeloops[1][5] == 0 then
        screen.level(15)
      elseif tapeloops[1][5] == 1 then
        screen.level(4)
      else
        screen.level(1)    
      end
      screen.line_width(4)
      screen.move(49,47)
      screen.line(49+x,47)
      screen.stroke()
    end
  end
  
  if tapeloops[2][3] == 1 then
    for x = 1, tapeloops[2][2] do
      screen.level(4)
      screen.line_width(4)
      screen.move(93,47)
      screen.line(93+x,47)
      screen.stroke()
    end
    if tapeloops[2][2] >= 32 then
      tapeloops[2][4] = 0
      tapeloops[2][3] = 0
      softcut.rec(2,0)
      softcut.play(2,1)
    end
  else
    for x = 1, tapeloops[2][2] do
      if tapeloops[2][5] == 0 then
        screen.level(15)
      elseif tapeloops[2][5] == 1 then
        screen.level(4)
      else
        screen.level(1)
      end
      screen.line_width(4)
      screen.move(93,47)
      screen.line(93+x,47)
      screen.stroke()
    end
  end
  screen.update()
  
end

function cleanup()
  
  audio:rev_off ()
  
end